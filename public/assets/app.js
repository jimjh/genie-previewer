// Generated by CoffeeScript 1.4.0

/*
verify.js
http://github.com/jimjh/genie-game
===
Copyright (c) 2012 Jiunn Haur Lim, Carnegie Mellon University
License: https://raw.github.com/jimjh/genie-game/master/LICENSE
*/


(function() {
  var Problem, genie, init;

  genie = (typeof exports !== "undefined" && exports !== null) && this || (this.genie = {});

  Problem = (function() {

    function Problem(button) {
      this.button = $(button);
    }

    Problem.prototype.observe = function() {
      var _this = this;
      return this.button.click(function(e) {
        _this.submit(_this.button.parents('form'));
        return false;
      });
    };

    Problem.prototype.submit = function(form) {
      return $.ajax({
        type: 'POST',
        url: form.attr('action'),
        data: form.serialize(),
        success: this.update(form)
      });
    };

    Problem.prototype.update = function(form) {
      var _this = this;
      return function(result) {
        var cell, i, input, j, row;
        switch (result) {
          case true:
            form.removeClass('error');
            form.addClass('success');
            break;
          case false:
            form.removeClass('success');
            form.addClass('error');
            break;
          default:
            for (i in result) {
              row = result[i];
              for (j in row) {
                cell = row[j];
                input = form.find("input[name='answer[" + i + "][" + j + "]']");
                (_this.update(input))(cell);
              }
            }
        }
        return null;
      };
    };

    return Problem;

  })();

  init = function() {
    var button, problem, _i, _len, _ref;
    _ref = $('a.button.submit');
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      button = _ref[_i];
      problem = new Problem(button);
      problem.observe();
    }
    return null;
  };

  this.genie.launch = function() {
    init();
    return $.ajaxSetup({
      beforeSend: function(xhr) {
        var token;
        token = $('meta[name="csrf-token"]').attr('content');
        return xhr.setRequestHeader('X-CSRF-Token', token);
      }
    });
  };

  $(this.genie.launch);

}).call(this);
